<!DOCTYPE html>
<html>
<head>
    <title>AR Painting</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="style.css">

    <!-- A-Frame and Mind AR -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.2.0/dist/aframe-extras.min.js"></script>
    <script src="texture-blender.js"></script>
    <script src="js/debug-ui.js"></script>
    <script src="js/main.js"></script>
</head>
<body>
    <div id="loading-screen">
        <div id="loading-content">
            <h1>AR Painting</h1>
            <p>Point your camera at the painting to begin.</p>
            <button id="start-button">Start</button>
        </div>
    </div>

    <div id="demo-controls" style="display: none;">
        <button id="morning-button">Morning</button>
        <button id="day-button">Day</button>
        <button id="night-button">Night</button>
    </div>
    <div id="debug-toggles" style="display: none;">
        <button id="toggle-time-btn">Time Controls</button>
        <button id="toggle-shader-btn">Shader Controls</button>
        <button id="toggle-lights-btn">Light Controls</button>
        <button id="toggle-transform-btn">Transform Controls</button>
    </div>
    <div id="shader-controls" style="display: none;">
        <div>
            <label for="threshold-slider">Noise Threshold:</label>
            <input type="range" id="threshold-slider" min="0" max="1" step="0.01" value="0.58">
            <span id="threshold-value"></span>
        </div>
        <div>
            <label for="softness-slider">Blend Softness:</label>
            <input type="range" id="softness-slider" min="0" max="0.5" step="0.01" value="0.37">
            <span id="softness-value"></span>
        </div>
        <div>
            <label for="scroll-x-slider">Scroll Speed X:</label>
            <input type="range" id="scroll-x-slider" min="-0.2" max="0.2" step="0.01" value="0.05">
            <span id="scroll-x-value"></span>
        </div>
        <div>
            <label for="scroll-y-slider">Scroll Speed Y:</label>
            <input type="range" id="scroll-y-slider" min="-0.2" max="0.2" step="0.01" value="-0.06">
            <span id="scroll-y-value"></span>
        </div>
        <div>
            <label for="roughness-slider">Roughness:</label>
            <input type="range" id="roughness-slider" min="0" max="2" step="0.01" value="1.0">
            <span id="roughness-value"></span>
        </div>
    </div>
    <div id="transform-controls" style="display: none;">
        <h3>Transform Controls</h3>
        <div>
            <label>Position X: <input type="range" id="pos-x" min="-1" max="1" step="0.01" value="0.27"><span id="pos-x-value"></span></label>
            <label>Position Y: <input type="range" id="pos-y" min="-1" max="1" step="0.01" value="-0.03"><span id="pos-y-value"></span></label>
            <label>Position Z: <input type="range" id="pos-z" min="-1" max="1" step="0.01" value="0.01"><span id="pos-z-value"></span></label>
        </div>
        <div>
            <label>Rotation X: <input type="range" id="rot-x" min="-180" max="180" step="1" value="0"><span id="rot-x-value"></span></label>
            <label>Rotation Y: <input type="range" id="rot-y" min="-180" max="180" step="1" value="1"><span id="rot-y-value"></span></label>
            <label>Rotation Z: <input type="range" id="rot-z" min="-180" max="180" step="1" value="0"><span id="rot-z-value"></span></label>
        </div>
        <div>
            <label>Scale: <input type="range" id="scale" min="0.1" max="5" step="0.01" value="0.56"><span id="scale-value"></span></label>
        </div>
        <button id="copy-transform-button">Copy Transform Settings</button>
    </div>
    <div id="scanning-overlay" style="display: none;">
        <div class="scanner-box">
            <img src="assets/marker.jpg" alt="Scan this image">
            <div class="scanner-line"></div>
            <p>Point your camera at the painting.</p>
        </div>
    </div>
    <div id="lighting-controls" style="display: none;">
        <h3>Lighting Controls</h3>
        <div id="morning-light-panel" class="light-panel">
            <h4>Morning</h4>
            <div class="light-control-group">
                <span>Hemi</span>
                <label>Intensity: <input type="range" id="morning-hemi-intensity" min="0" max="2" step="0.01" value="1"><span id="morning-hemi-intensity-value"></span></label>
                <label>Sky: <input type="color" id="morning-hemi-color" value="#f9e3ca"></label>
                <label>Ground: <input type="color" id="morning-hemi-ground" value="#a8774d"></label>
            </div>
            <div class="light-control-group">
                <span>Dir</span>
                <label>Intensity: <input type="range" id="morning-dir-intensity" min="0" max="2" step="0.01" value="0.54"><span id="morning-dir-intensity-value"></span></label>
                <label>Color: <input type="color" id="morning-dir-color" value="#f2ded1"></label>
                <label>X: <input type="range" id="morning-dir-x" min="-2" max="2" step="0.1" value="-1.3"><span id="morning-dir-x-value"></span></label>
                <label>Y: <input type="range" id="morning-dir-y" min="-2" max="2" step="0.1" value="0.4"><span id="morning-dir-y-value"></span></label>
                <label>Z: <input type="range" id="morning-dir-z" min="-2" max="2" step="0.1" value="-1"><span id="morning-dir-z-value"></span></label>
            </div>
        </div>
        <div id="day-light-panel" class="light-panel" style="display: none;">
            <h4>Day</h4>
            <div class="light-control-group">
                <span>Hemi</span>
                <label>Intensity: <input type="range" id="day-hemi-intensity" min="0" max="2" step="0.01" value="0.6"><span id="day-hemi-intensity-value"></span></label>
                <label>Sky: <input type="color" id="day-hemi-color" value="#ffffff"></label>
                <label>Ground: <input type="color" id="day-hemi-ground" value="#bbbbbb"></label>
            </div>
            <div class="light-control-group">
                <span>Dir</span>
                <label>Intensity: <input type="range" id="day-dir-intensity" min="0" max="2" step="0.01" value="0.47"><span id="day-dir-intensity-value"></span></label>
                <label>Color: <input type="color" id="day-dir-color" value="#ffffff"></label>
                <label>X: <input type="range" id="day-dir-x" min="-2" max="2" step="0.1" value="0.5"><span id="day-dir-x-value"></span></label>
                <label>Y: <input type="range" id="day-dir-y" min="-2" max="2" step="0.1" value="1"><span id="day-dir-y-value"></span></label>
                <label>Z: <input type="range" id="day-dir-z" min="-2" max="2" step="0.1" value="1"><span id="day-dir-z-value"></span></label>
            </div>
        </div>
        <div id="night-light-panel" class="light-panel" style="display: none;">
            <h4>Night</h4>
            <div class="light-control-group">
                <span>Hemi</span>
                <label>Intensity: <input type="range" id="night-hemi-intensity" min="0" max="2" step="0.01" value="0.83"><span id="night-hemi-intensity-value"></span></label>
                <label>Sky: <input type="color" id="night-hemi-color" value="#6a85b0"></label>
                <label>Ground: <input type="color" id="night-hemi-ground" value="#222233"></label>
            </div>
            <div class="light-control-group">
                <span>Dir</span>
                <label>Intensity: <input type="range" id="night-dir-intensity" min="0" max="2" step="0.01" value="0.89"><span id="night-dir-intensity-value"></span></label>
                <label>Color: <input type="color" id="night-dir-color" value="#8899ff"></label>
                <label>X: <input type="range" id="night-dir-x" min="-2" max="2" step="0.1" value="1"><span id="night-dir-x-value"></span></label>
                <label>Y: <input type="range" id="night-dir-y" min="-2" max="2" step="0.1" value="0.5"><span id="night-dir-y-value"></span></label>
                <label>Z: <input type="range" id="night-dir-z" min="-2" max="2" step="0.1" value="-1"><span id="night-dir-z-value"></span></label>
            </div>
        </div>
        <button id="copy-lights-button">Copy Light Settings</button>
    </div>

    <!-- The AR experience is embedded in an A-Frame scene. MindAR is added dynamically. -->
    <a-scene
        scene-manager
        color-space="sRGB"
        renderer="colorManagement: true, physicallyCorrectLights"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false"
    >
        <a-assets>
            <a-asset-item id="model" src="assets/sleeping CLIP v2.glb"></a-asset-item>
            <img id="scanTexture" src="assets/scan_texture.jpg" crossorigin="anonymous">
            <img id="paintingTexture" src="assets/marker.jpg" crossorigin="anonymous">
            <img id="noiseMap" src="assets/noiseTexture.png" crossorigin="anonymous">
            <img id="normalMap" src="assets/normal.png" crossorigin="anonymous">
            <img id="roughnessMap" src="assets/roughness.jpg" crossorigin="anonymous">
            <audio id="music-morning" src="assets/music_morning.wav" preload="auto" loop></audio>
            <audio id="music-day" src="assets/music_day.wav" preload="auto" loop></audio>
            <audio id="music-night" src="assets/music_night.wav" preload="auto" loop></audio>
        </a-assets>
        
        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

        <a-entity id="target" visible="false">
            <a-plane
                id="marker-plane"
                src="#paintingTexture"
                width="1"
                height="0.75"
                material="opacity: 0.5; transparent: true"
                visible="false"
            ></a-plane>
            <a-entity
                id="model-entity"
                gltf-model="#model"
                scale="0.56 0.56 0.56"
                position="0.27 -0.03 0.01"
                rotation="0 1 0"
                texture-blender="
                    scanTexture: #scanTexture;
                    paintingTexture: #paintingTexture;
                    noiseMap: #noiseMap;
                    normalMap: #normalMap;
                    roughnessMap: #roughnessMap;
                    roughnessFactor: 1.0;
                    threshold: 0.58;
                    blendSoftness: 0.37;
                    noiseScrollSpeedX: 0.05;
                    noiseScrollSpeedY: -0.06;
                "
            >
            </a-entity>
        </a-entity>

        <!-- Hemisphere lights for soft ambient color -->
        <a-entity id="morning-hemi-light" light="type: hemisphere; color: #f9e3ca; groundColor: #a8774d; intensity: 0;"></a-entity>
        <a-entity id="day-hemi-light" light="type: hemisphere; color: #ffffff; groundColor: #bbbbbb; intensity: 0;"></a-entity>
        <a-entity id="night-hemi-light" light="type: hemisphere; color: #6a85b0; groundColor: #222233; intensity: 0;"></a-entity>
        
        <!-- Directional lights for highlights and definition -->
        <a-entity id="morning-dir-light" light="type: directional; color: #f2ded1; intensity: 0" position="-1.3 0.4 -1"></a-entity>
        <a-entity id="day-dir-light" light="type: directional; color: #ffffff; intensity: 0" position="0.5 1 1"></a-entity>
        <a-entity id="night-dir-light" light="type: directional; color: #8899ff; intensity: 0" position="1 0.5 -1"></a-entity>
    </a-scene>
</body>
</html> 